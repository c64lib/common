
plugins {
    id "de.undercouch.download" version "3.4.3"
}

def kaJar = new File(buildDir,'ka/KickAss.jar')

task downloadKickAss(type: Download) {
	ext.version = '5.0'
    src "https://github.com/c64lib/asm-ka/releases/download/$version/KickAss.jar"
    dest kaJar
}

task kickAss(type: JavaExec, dependsOn: downloadKickAss) {
	ext.inputFile = 'common.asm'
	main '-jar'			
	args kaJar, '-libdir', libdir, inputFile
}

task clean {
	delete buildDir
	delete fileTree(".").matching {
		include "**/*.prg", "**/*.sym"
	}
}

task assemble(dependsOn: downloadKickAss) {
	description 'Launch KickAssembler on each asm file in the project'
	fileTree(dir: '.', include: '**/*.asm', exclude: 'cpm_modules').each { file ->
		doLast {
			println file.path
			javaexec {
				main '-jar'
				args kaJar, '-libdir', '..', file.path
			}
		}
	}
}

task build(dependsOn: assemble) {
}

